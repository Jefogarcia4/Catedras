<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
        <title>Catedras</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.4.5.min.css">
		<link rel="stylesheet" type="text/css" href="css/estilos.css">
		<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
    </head>
    <body>
     <div id="homepage" data-role="page" class="fondo">
        <div  data-role="header">
        	 <img class="logo" src="img/Logo_Usb.jpg" alt="Logo Usb" />
        	 <br/>
        	 <h2 style="text-align: center;">CÁTEDRA ABIERTA USB</h4>
        </div>
        	  <div data-role="content">
            <form>
                <div class="espacios">
                <br/>
               <p> Fecha Desde</p>
                <input id="txtFecha" type="date" required data-native-menu="true" class="form-control controlText"  />
               <p> Fecha Hasta</p>
                <input id="txtFechaFinal" type="date" required data-native-menu="true" class="form-control controlText" />
                <p>Sede</p>
                <select id="ddlSedes" name="Sedeslst" data-native-menu="true" class="form-control controlText">
                    <option>Seleccione una sede</option>
                </select>
                </div>
				</div>
                <div id="content">
                </div>
            </form>
            <div style="clear:both"></div>
        </div>
        
    </div>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>
        <script type="text/javascript" src="js/jquery.mobile-1.4.5.min.js"></script>
        <script type="text/javascript" src="js/bootstrap.min.js"></script>
 <script>
        $(document).ready(function () {
            var idSede;
            $.ajax({
                url: 'http://wapicatedrasusb.azurewebsites.net/api/Catedras/ListarSedes',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    idSede = data.SedeId;
                    $.each(data, function (i, item) {
                        console.log(item.NombreSede)
                        $('<option value="' + item.SedeId + '">' + item.NombreSede + '</option>').appendTo('#homepage #ddlSedes');
                    });
                },
                error: function () {
                    console.log('err')
                }
            });

            $('select#ddlSedes').on('change', function () {
                $('#content').html('');
                var valor = $(this).val();
                $.ajax({
                    url: 'http://wapicatedrasusb.azurewebsites.net/api/Catedras/ListarPorSedes?sedeId=' + valor + '&fecha=' + txtFecha.value + '&fechaFinal=' + txtFechaFinal.value,
                    type: 'GET',
                    dataType: 'json',
                    success: function (data) {
                        $.each(data, function (i, item) {
                            var lstDisponibles = '<div class="row"><div class="col-xs-12"><div class="panel panel-primary"><div class="panel-heading"><div class="row"><div class="col-xs-8"><div><strong>Lugar: </strong>'+ item.NombreLugar +'</div></div><div class="col-xs-4 text-right"><div class="huge">'+ getFormattedDate(item.Fecha) +'</div> <div>'+ formatAMPM('01/01/2017 ' + item.Hora) +'</div></div></div></div><a href="#"> <div class="panel-footer"> <div class="pull-left"><strong>Facultad: </strong> ' + item.NombreFacultad +'</div><br/><div class="pull-left"> <strong>Ciclo: </strong>'+ item.Ciclo +'</div><br/><div class="pull-left"> <strong>Descripción: </strong>'+ item.Descripcion +'</div> <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span><div class="clearfix"></div> </div></a></div></div></div>';
                            $("#content").append(lstDisponibles);
                        });
                    },
                    error: function () {
                        console.log('err')
                    }
                });
            });
        });

function getFormattedDate(dateOrigin) {
       var dateE = new Date(dateOrigin);
    var day = dateE.getDate() + 1;
    var monthIndex = dateE.getMonth() + 1;
    var year = dateE.getFullYear();
    var hours = dateE.getHours();
    var minutes = dateE.getMinutes();
    var formatDate = day + "/" + monthIndex + "/" + year;
    return formatDate;
    }

        function formatAMPM(date) {
       var todayTime = new Date(date);
       var hours = todayTime.getHours();
       var minutes = todayTime.getMinutes();
       var ampm = hours >= 12 ? 'pm' : 'am';
       hours = hours % 12;
       hours = hours ? hours : 12; // the hour '0' should be '12'
       minutes = minutes < 10 ? '0' + minutes : minutes;
       var strTime = hours + ':' + minutes + ' ' + ampm;
       return strTime;
    }
    </script>
   
    </body>
</html>
